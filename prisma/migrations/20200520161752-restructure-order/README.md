# Migration `20200520161752-restructure-order`

This migration has been generated by rahul at 5/20/2020, 4:17:52 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."bids" (
"active" boolean   DEFAULT true,"created" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" SERIAL,"orders" integer  NOT NULL ,"price" Decimal(65,30)  NOT NULL ,"status" integer   DEFAULT 0,"updated" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"users" integer  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."orders" (
"active" boolean   DEFAULT true,"created" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"expiry_date" timestamp(3)   ,"id" SERIAL,"maker_address" integer  NOT NULL ,"maker_category" integer  NOT NULL ,"maker_token_id" integer  NOT NULL ,"min_price" Decimal(65,30)  NOT NULL ,"price" Decimal(65,30)  NOT NULL ,"signature" text  NOT NULL ,"status" integer   DEFAULT 0,"taker_address" integer   ,"taker_amount" Decimal(65,30)   ,"taker_token" integer  NOT NULL ,"txhash" text   ,"type" text  NOT NULL ,"updated" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"views" integer   DEFAULT 0,
    PRIMARY KEY ("id"))

ALTER TABLE "public"."bids" ADD FOREIGN KEY ("orders")REFERENCES "public"."orders"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."bids" ADD FOREIGN KEY ("users")REFERENCES "public"."users"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."orders" ADD FOREIGN KEY ("maker_address")REFERENCES "public"."users"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."orders" ADD FOREIGN KEY ("maker_token_id")REFERENCES "public"."tokens"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."orders" ADD FOREIGN KEY ("maker_category")REFERENCES "public"."categories"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."orders" ADD FOREIGN KEY ("taker_address")REFERENCES "public"."users"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."orders" ADD FOREIGN KEY ("taker_token")REFERENCES "public"."erc20tokens"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200520125551-rename-tokenid..20200520161752-restructure-order
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 model bids {
   active      Boolean? @default(true)
@@ -30,8 +30,9 @@
   updated           DateTime            @default(now())
   url               String?
   categoryaddresses categoryaddresses[]
   tokens            tokens[]
+  orders            orders[]
 }
 model categoryaddresses {
   active     Boolean?   @default(true)
@@ -83,12 +84,13 @@
   created              DateTime    @default(now())
   expiry_date          DateTime?
   id                   Int         @default(autoincrement()) @id
   maker_address        Int
-  maker_amount         Float
-  maker_token          Int
+  maker_token_id       Int
+  maker_category       Int
   min_price            Float
-  signature            String?
+  price                Float
+  signature            String
   status               Int?        @default(0)
   taker_address        Int?
   taker_amount         Float?
   taker_token          Int
@@ -96,9 +98,10 @@
   type                 String
   updated              DateTime    @default(now())
   views                Int?        @default(0)
   maker_addressTousers users       @relation("orders_maker_addressTousers", fields: [maker_address], references: [id])
-  tokens               tokens      @relation(fields: [maker_token], references: [id])
+  tokens               tokens      @relation(fields: [maker_token_id], references: [id])
+  categories           categories  @relation(fields: [maker_category], references: [id])
   taker_addressTousers users?      @relation("orders_taker_addressTousers", fields: [taker_address], references: [id])
   erc20tokens          erc20tokens @relation(fields: [taker_token], references: [id])
   bids                 bids[]
 }
```


